openapi: 3.1.0
info:
  title: LLM Service
  version: 1.0.0
paths:
  /v1/generate:
    post:
      tags:
      - generate-sse
      summary: Generate Stream
      description: "SSE-aware /v1/generate:\n  - If client asks for 'text/event-stream'\
        \ (or body.stream==True): stream tokens.\n  - Prefers OpenAI native streaming\
        \ when available.\n  - Falls back to HF non-streaming + token-chunking (still\
        \ emits llm.token/llm.done).\n  - If neither provider configured, returns\
        \ 503 via HTTPException.\nThis keeps the route compatible with your orchestrator\
        \ (POST /v1/generate + Accept: text/event-stream)."
      operationId: generate_stream_v1_generate_post
      parameters:
      - name: accept
        in: header
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          default: ''
          title: Accept
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /v1/health:
    get:
      summary: Health
      operationId: health_v1_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /v1/metrics:
    get:
      summary: Metrics
      operationId: metrics_v1_metrics_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /v1/generate_json:
    post:
      summary: Generate Json
      description: 'Non-streaming JSON generate endpoint.

        NOTE: Streaming is served by POST /v1/generate via app.routes.generate_sse.'
      operationId: generate_json_v1_generate_json_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
components:
  schemas:
    ChatRequest:
      properties:
        messages:
          items:
            $ref: '#/components/schemas/Message'
          type: array
          title: Messages
        temperature:
          type: number
          title: Temperature
          default: 0.2
        stream:
          type: boolean
          title: Stream
          default: false
        tools:
          anyOf:
          - items:
              $ref: '#/components/schemas/ToolHint'
            type: array
          - type: 'null'
          title: Tools
      type: object
      required:
      - messages
      title: ChatRequest
    ChatResponse:
      properties:
        provider:
          type: string
          title: Provider
        model:
          type: string
          title: Model
        output:
          type: string
          title: Output
        fallback_used:
          type: boolean
          title: Fallback Used
          default: false
      type: object
      required:
      - provider
      - model
      - output
      title: ChatResponse
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    Message:
      properties:
        role:
          type: string
          title: Role
        content:
          type: string
          title: Content
      type: object
      required:
      - role
      - content
      title: Message
    ToolHint:
      properties:
        schema:
          type: object
          title: Schema
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
      type: object
      required:
      - schema
      title: ToolHint
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
